Q=function(itemSelector){if(typeof itemSelector=="string"){this.items=document.querySelectorAll(itemSelector)}
this.attr=function(key,value){if(value){this.items.forEach(function(item){item.setAttribute(key,value)})}else{return this.items[0].getAttribute(key)}
return this}
this.addClass=function(name){this.items.forEach(function(item){if(item.className.indexOf(name)==-1){item.className=[item.className,name].join(" ")}})
return this}
this.removeClass=function(name){this.items.forEach(function(item){if(item.className.indexOf(name)!=-1){item.className=item.className.split(" ").filter(function(cName){return cName==name}).join(" ")}})
return this}
this.ajax=function(options){optins=options||{};return new Q.Promise(function(resolve,reject){var xhttp=new XMLHttpRequest();xhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){if(!options.type||options.type=='json'){var data=Q.json(this.responseText)}else{var data=this.responseText}
resolve(data)}};xhttp.open(options.method,options.url,!0);xhttp.send(Q.json(options.data))})}
this.get=function(url,data){opts.method="GET";opts.url=[url,"?",Q.parameterize(data)].join("");return this.ajax(opts)}
this.post=function(url,data){opts.method="POST";opts.url=url;opts.data=data;return this.ajax(opts)}
this.put=function(url,data){opts.method="PUT";opts.url=url;opts.data=data;return this.ajax(opts)}
return this}
Q.parameterize=function(data){return Object.keys(data).map(function(key){[key,'=',data[key]].join("")}).join("&")}
Q.json=function(data){if(typeof data=="string"){try{var data=JSON.parse(data)}catch(e){var data="error"}
return data}else{try{var data=JSON.stringify(data)}catch(e){var data="error"}
return data}}
Q.Promise=function(callback){var opts={};resolve=function(params){opts.resParams=params;(opts.thens||[]).forEach(function(res){res.apply(opts,[params])})}
reject=function(params){opts.rejParams=params;(opts.catchs||[]).forEach(function(rej){rej.apply(opts,[params])})}
opts.then=function(thenCallback){if(opts.resParams){thenCallback.apply(opts,[opts.resParams])}else{opts.thens=opts.thens||[];opts.thens.push(thenCallback)}}
opts.catch=function(catchCallback){if(opts.rejParams){catchCallback.apply(opts,[opts.rejParams])}else{opts.catchs=opts.catchs||[];opts.catchs.push(catchCallback)}}
callback(resolve,reject)
return opts}